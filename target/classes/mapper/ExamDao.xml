<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sy.dao.ExamDao">
	<!-- 目的：为DAO接口方法提供sql语句配置 -->
	
	<resultMap id="ExamMap" type="com.sy.entity.Exam">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="examName" property="examName" jdbcType="VARCHAR" />
		<result column="classname" property="classname" jdbcType="VARCHAR" />
		<result column="coursename" property="coursename" jdbcType="VARCHAR" />
		<result column="startTime" property="startTime" jdbcType="VARCHAR" />
		<result column="endTime" property="endTime" jdbcType="VARCHAR" />
		<result column="timelength" property="timelength" jdbcType="INTEGER" />
		<result column="stotal" property="stotal" jdbcType="INTEGER" />
	</resultMap>
	
	<resultMap id="ExamCloseMap" type="com.sy.entity.ExamClose">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="examName" property="examName" jdbcType="VARCHAR" />
		<result column="classname" property="classname" jdbcType="VARCHAR" />
		<result column="coursename" property="coursename" jdbcType="VARCHAR" />
		<result column="startTime" property="startTime" jdbcType="VARCHAR" />
		<result column="endTime" property="endTime" jdbcType="VARCHAR" />
		<result column="timelength" property="timelength" jdbcType="INTEGER" />
		<result column="stotal" property="stotal" jdbcType="INTEGER" />
	</resultMap>
	
	<resultMap id="FilesMap" type="com.sy.entity.Files">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="classname" property="classname" jdbcType="VARCHAR" />
		<result column="username" property="username" jdbcType="VARCHAR" />
		<result column="filename" property="filename" jdbcType="VARCHAR" />
		<result column="filecontent" property="filecontent" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="AnswersMap" type="com.sy.entity.Answers">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="examId" property="examId" jdbcType="INTEGER" />
		<result column="examname" property="examname" jdbcType="VARCHAR" />
		<result column="classname" property="classname" jdbcType="VARCHAR" />
		<result column="coursename" property="coursename" jdbcType="VARCHAR" />
		<result column="username" property="username" jdbcType="VARCHAR" />
		<result column="answers" property="answers" jdbcType="VARCHAR" />
	</resultMap>
	
	<!-- 分页SQL语句 --> 
    <select id="findExamByPage" resultMap="ExamMap"> 
        select * 
        from exam limit #{startPos},#{pageSize}  
    </select> 
    
    <select id="findExamByClassname" resultMap="ExamMap"> 
        select * 
        from exam where classname = #{classname} order by id limit #{startPos},#{pageSize}  
    </select> 
    
    <select id="findPaperByUsername" resultMap="FilesMap"> 
        select * 
        from files where username = #{username} order by id limit #{startPos},#{pageSize}  
    </select> 
    
    
    <insert id="addExam" parameterType="com.sy.entity.Exam" useGeneratedKeys="true" keyProperty="id">
         insert into exam (exam_name,classname,coursename,start_time,end_time,timelength,stotal) values (#{examName},#{classname},#{coursename},#{startTime},#{endTime},#{timelength},#{stotal})
    </insert> 
    
    
    <insert id="addFiles" parameterType="com.sy.entity.Files">
         insert into files (classname,username,filename,filecontent) values (#{classname},#{username},#{filename},#{filecontent})
    </insert> 
    
    <insert id="addAnswers" parameterType="com.sy.entity.Answers" useGeneratedKeys="true" keyProperty="id">
         insert into answers (examname,classname,coursename,username,answers) values (#{examname},#{classname},#{coursename},#{username},#{answers})
    </insert> 
    
	
	<!-- 取得记录的总数 --> 
	<select id="getExamCount" resultType="long">
        SELECT COUNT(*) FROM exam  
	</select>
	
	<select id="getECByClassname" resultType="long">
        SELECT COUNT(*) FROM exam where classname = #{classname} 
	</select>
	
	<select id="getPCByUsername" resultType="long">
        SELECT COUNT(*) FROM files where username = #{username} 
	</select>
	
	<select id="getCountGrade" resultType="long">
        SELECT COUNT(*) FROM grade where examname = #{examname} and classname = #{classname} and examstatus = #{examstatus}
	</select>
	
	<select id="getCountGradeU" resultType="long">
        SELECT COUNT(*) FROM grade where examname = #{examname} and classname = #{classname} and grade > #{grade}
	</select>
	
	<!-- 查询一个班级的人数 -->
	<select id="getStotal" resultType="long">
        SELECT COUNT(*) FROM grade where examname = #{examname} and classname = #{classname}
	</select>
	
	<select id="getExamNum" resultType="long">
        SELECT COUNT(*) FROM org_user where org_id = #{id}
	</select>
	
	
</mapper>	